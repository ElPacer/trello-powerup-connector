/*
 * Copyright (c) 2025 Pacen Life Games. All rights reserved.
 *
 * This software and associated documentation files (the "Software") are the 
 * confidential and proprietary information of Pacen Life Games ("Company"). 
 * You shall not disclose or distribute the Software in whole or in part 
 * without the prior written permission of the Company.
 *
 * The Software is provided "AS IS", without warranty of any kind, express or 
 * implied, including but not limited to the warranties of merchantability, 
 * fitness for a particular purpose, and noninfringement. In no event shall 
 * the Company or its contributors be liable for any claim, damages, or other 
 * liability, whether in an action of contract, tort, or otherwise, arising 
 * from, out of, or in connection with the Software or the use or other 
 * dealings in the Software.
 */


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Authorize Power-Up</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 16px; }
    button { padding: 10px 14px; border: none; border-radius: 8px; cursor: pointer; }
    #go { background: #0079bf; color: #fff; }
    #msg { margin-top: 10px; color: #555; font-size: 14px; }
  </style>
</head>
<body>
  <h2>Authorize this Power-Up</h2>
  <p>Click the button below to let this Power-Up act on your behalf (read & write) to create boards, lists, cards, and more.</p>
  <button id="go">Authorize</button>
  <div id="msg"></div>

  <!-- Trello Power-Up client library -->
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <script>
    // === EDIT THIS to your real Trello app key (same as in client.js) ===
    const APP_KEY   = '23264f266db9bdcb44de1633cef89d0b';
    const APP_NAME  = 'Pacers Trello JSON importer v0.1';
    const APP_AUTHOR= 'Pacen Life';

    const t = window.TrelloPowerUp.iframe({
      appKey: APP_KEY,
      appName: APP_NAME,
      appAuthor: APP_AUTHOR
    });

    const msg = (m)=>{ document.getElementById('msg').textContent = m; };

    t.render(function () {
      document.getElementById('go').addEventListener('click', async function () {
        try {
          msg('Opening Trello authorizationâ€¦');
          await t.getRestApi().authorize({
            scope: 'read,write',   // request only what you need
            expiration: 'never'    // or '30days', '1day', '1hour'
          });
          msg('Authorized! You can close this window.');
          // Close popup and return to the importer
          await t.closePopup();
        } catch (err) {
          if (err && err.name === 'AuthDeniedError') {
            msg('Authorization was cancelled. You can try again.');
          } else {
            msg('Authorization failed: ' + (err && err.message ? err.message : err));
          }
        }
      }, false);
    });
  </script>
</body>
</html>
